<?xml version="1.0" encoding="utf-8"?>
<data noupdate="1">

    <record id="view_task_form_fs_approvals_inherit" model="ir.ui.view">
        <field name="name">project.task.form.fs.approvals.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">

            <!-- Zona de smart buttons -->
            <xpath expr="//sheet//div[@class='oe_button_box']" position="inside">
                <!-- Smart button: Aprobaciones -->
                <button name="action_view_approvals"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-check-square">
                    <field name="approval_count" widget="statinfo" string="Aprobaciones"/>
                </button>

                <!-- Smart button: Gastos -->
                <button name="action_view_expenses"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-money">
                    <field name="expense_count" widget="statinfo" string="Gastos"/>
                </button>
            </xpath>

            <!-- Botón: Solicitud de viáticos (solo si tarea aceptada) -->
            <xpath expr="//header" position="inside">
                <button name="action_request_travel"
                        type="object"
                        string="Solicitud de viáticos"
                        class="btn-primary"
                        invisible="fs_status != 'accepted' and not fs_decision_locked"
                        groups="industry_fsm.group_fsm_user,!project.group_project_manager"/>
            </xpath>

                <!-- Smart button en el button_box -->
                <xpath expr="//div[contains(@class,'oe_button_box')]" position="inside">
                    <button name="action_view_fs_commission_bills"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-file-text-o"
                            invisible="fs_commission_bill_count == 0">
                        <field name="fs_commission_bill_count" widget="statinfo" string="Comisión"/>
                    </button>
                </xpath>

            <xpath expr="//header" position="inside">
                <button name="action_fs_open_availability_task"
                        type="object"
                        string="Ver disponibilidad"
                        class="btn-primary"
                        invisible="stage_id.fs_is_backlog_stage != True"
                        groups="industry_fsm.group_fsm_manager"/>
            </xpath>
            <!-- Botón: Declarar gastos (solo si tarea aceptada o en etapa done) -->
            <xpath expr="//header" position="inside">
                <button name="action_declare_expenses"
                        type="object"
                        string="Declarar gastos"
                        class="btn-secondary"
                        invisible="fs_status != 'accepted' and stage_id.fs_is_done_stage != True"
                        groups="industry_fsm.group_fsm_user,!project.group_project_manager"/>
            </xpath>
        </field>
    </record>

  </data>
